<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><script src="https://fast.appcues.com/88539.js"></script><script src="https://dielduarte.dev/blog/onrouteupdate.js"></script><style data-href="/blog/styles.400e59807eab519e537c.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.FloatMenu-module--menu--3DIQJ{position:fixed;bottom:-1px;right:0;cursor:pointer;padding:20px;width:100%;background:#fff;transform:translateY(187px);color:#22272c;transition:transform .2s,background .2s,color .2s}.FloatMenu-module--option--Fgcwy{transition:transform .2s;margin-right:10px;border:none;background:transparent;display:inline-block}.FloatMenu-module--option--Fgcwy:hover{cursor:pointer;transform:scale(1.2)}.FloatMenu-module--flag--1gcwG{width:30px;border-radius:4px}.FloatMenu-module--vader--PLIU6{width:34px;height:30px}.FloatMenu-module--trooper--OWxUE{width:28px}.FloatMenu-module--title--21W0t{padding-right:20px}.FloatMenu-module--subtitle--PTEKX{margin-top:20px;margin-bottom:10px}.FloatMenu-module--avatar--2Zizz{cursor:pointer;position:absolute;top:-37px;z-index:999999999;width:50px;right:20px;transition:top .2s}.FloatMenu-module--avatar--2Zizz:hover{top:-55px}.FloatMenu-module--openSettings--2rlaT{visibility:hidden}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ{transform:translateY(0)}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ .FloatMenu-module--avatar--2Zizz:hover{top:-37px}body.light-theme .FloatMenu-module--menu--3DIQJ{background:#22272c;color:#fff}@media(max-width:780px){.FloatMenu-module--menu--3DIQJ{transform:translateY(202px)}.FloatMenu-module--avatar--2Zizz{right:10px}}*{margin:0;padding:0;box-sizing:border-box;font-family:Press Start\ 2P,cursive}body{background:#22272c;color:#fff;transition:background .2s,color .2s}body.light-theme{color:#22272c;background:#fff}.global-module--container--ny7W9{max-width:1020px;margin:0 auto}.global-module--prefetchLink--hIA84{visibility:hidden;font-size:0}.PostList-module--posts--2R_sN{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:20px}.PostList-module--post--13-tS{width:calc(33.33% - 20px);background-color:#404447;padding:20px 20px 30px;box-shadow:none;text-decoration:none;position:relative;color:#fff;min-height:220px}.PostList-module--title--3NqQ3{text-decoration:none;font-size:13px;margin-bottom:20px;line-height:1.9em;min-height:48px}.PostList-module--description--39upC{font-family:Roboto,sans-serif;font-size:14px;line-height:1.5em}.PostList-module--date--3Ygsq{font-size:8px;position:absolute;bottom:10px;right:20px;padding:4px}@media(max-width:1040px){.PostList-module--posts--2R_sN{padding:0 20px}}@media(max-width:780px){.PostList-module--posts--2R_sN{display:block}.PostList-module--post--13-tS{display:block;width:100%;margin-right:0;margin-bottom:20px}}.blog-post-module--root--hhWTX{max-width:780px}.blog-post-module--content--c97Ib{padding-bottom:60px;margin:0 auto}.blog-post-module--content--c97Ib *{font-family:Roboto,sans-serif;font-size:18px;line-height:1.58em}.blog-post-module--content--c97Ib p{margin:30px 0}.blog-post-module--content--c97Ib h1,.blog-post-module--content--c97Ib h2,.blog-post-module--content--c97Ib h3,.blog-post-module--content--c97Ib h4,.blog-post-module--content--c97Ib h5,.blog-post-module--content--c97Ib h6{font-family:Press Start\ 2P,cursive;margin:30px 0}.blog-post-module--content--c97Ib h2{font-size:20px}.blog-post-module--content--c97Ib h3{font-size:14px}.subtitle--separator:before{content:". . .";display:block;width:100%;text-align:center;margin-bottom:50px;margin-top:50px}.language-text{color:#d78838!important;border:1px solid #3c3e42;padding:0 4px;border-radius:4px}.language-js,.language-js span{font-family:Fira Code,monospace!important}.blog-post-module--content--c97Ib a{display:inline-block;color:#d78838}.blog-post-module--content--c97Ib ol,.blog-post-module--content--c97Ib ul{margin:20px 0;list-style:none}.blog-post-module--content--c97Ib ul li{margin-bottom:10px}.blog-post-module--content--c97Ib ul li:before{content:"=>";font-family:Press Start\ 2P,cursive;font-size:10px;padding-right:10px;color:#d78838}.blog-post-module--content--c97Ib blockquote{border-left:4px solid #3e7068;padding-left:10px;margin:40px 0 40px 18px}.blog-post-module--content--c97Ib img,.blog-post-module--content--c97Ib video{max-width:100%;-o-object-fit:cover;object-fit:cover;display:block;margin:0 auto}@media(max-width:1040px){.blog-post-module--content--c97Ib{padding:1.4em}}.blog-post-module--disqus-container--1fggW{padding:0}@media(max-width:780px){.blog-post-module--disqus-container--1fggW{padding:0 1.4em}}.BackButton-module--button--NQDXr{font-size:18px;color:#fff;background:transparent;border:none;margin-top:20px;text-decoration:none;display:block;position:relative;transition:left .3s;left:0}.BackButton-module--button--NQDXr:hover{left:-4px}body.light-theme .BackButton-module--button--NQDXr{color:#22272c}@media(max-width:1040px){.BackButton-module--button--NQDXr{padding-left:12px}}.layout-module--title--2pFnw{font-size:24px;text-align:center;padding:50px 20px 30px;line-height:34px}.layout-module--link--9VMjY{box-shadow:none;text-decoration:none;color:inherit}@media(max-width:780px){.layout-module--title--2pFnw{padding:70px 20px 60px}}</style><meta name="generator" content="Gatsby 2.27.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8e659aea3a609f7031f6051b55e1472a" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8e659aea3a609f7031f6051b55e1472a"/><title data-react-helmet="true">Mastering code splitting with webpack | Diel Duarte blog</title><meta data-react-helmet="true" name="description" content="let&#x27;s talk about how Webpack can help us to code splitting and achieve the goal of better website performance."/><meta data-react-helmet="true" property="og:title" content="Mastering code splitting with webpack"/><meta data-react-helmet="true" property="og:description" content="let&#x27;s talk about how Webpack can help us to code splitting and achieve the goal of better website performance."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://dielduarte.devnull"/><meta data-react-helmet="true" property="twitter:image" content="https://dielduarte.devnull"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Diel Duarte"/><meta data-react-helmet="true" name="twitter:title" content="Mastering code splitting with webpack"/><meta data-react-helmet="true" name="twitter:description" content="let&#x27;s talk about how Webpack can help us to code splitting and achieve the goal of better website performance."/><link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Roboto|Fira+Code&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/blog/webpack-runtime-b11e3e4497b6e9cbf82d.js"/><link as="script" rel="preload" href="/blog/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/blog/app-41047341e2e61b8de57d.js"/><link as="script" rel="preload" href="/blog/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/blog/commons-9c8d01ef9560c35d21d1.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"/><link as="fetch" rel="preload" href="/blog/page-data/en/mastering-code-splitting-with-webpack/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-module--container--ny7W9 blog-post-module--root--hhWTX"><a class="BackButton-module--button--NQDXr" href="/blog/">&lt;=</a><header><h1 class="layout-module--title--2pFnw">Mastering code splitting with webpack</h1></header><main><a class="global-module--prefetchLink--hIA84" href="/blog/pt-br/dominando-code-splitting-com-webpack">/pt-br/dominando-code-splitting-com-webpack</a><div class="blog-post-module--content--c97Ib"><p>code splitting is a build time process that splits pieces of your code into async chunks, let‚Äôs talk about how Webpack can help us to code split and achieve the goal of better website performance.</p>
<h2 class="subtitle--separator">But first, How to know when I have to split my code?</h2>
<p>The most expensive part of rendering websites is about downloading, and parsing  Javascript and css. That said, if we don‚Äôt need to render a specific piece of code on the first render, this code is a good candidate to split and be downloaded by demand, no secrets so far.</p>
<p>Google Chrome has a nice dev tool called <code class="language-text">coverage</code> that shows what percentage of the code delivered it‚Äôs being used. This might be used as a metric to follow and know how much code might be split and downloaded by demand. </p>
<p>To use the coverage tool just open your dev tools, <code class="language-text">cmd/ctrl + p</code>, and type <code class="language-text">show coverage</code>:</p>
<p><img src="/blog/images/coverage.png" alt="image showing how to access coverage tab on chrome dev tools"> </p>
<p>then, on the coverage tab click on the reload button and wait until the website is reloaded, this will show you how much code you are using on that specific page per asset downloaded. It‚Äôs AMAZING! üòç</p>
<p><img src="/blog/images/result.png" alt="image showing coverage tab, where we can see a list of assets downloaded and how much code is not being used in red."> </p>
<p>In the example above, 46% of the code delivered is <code class="language-text">not</code> being used! but that metric is also relative, depends on file size and many other variables, so the context/scenario is super important when using these tools.</p>
<h2>Code splitting and webpack</h2>
<p>With webpack we have two ways to work with code splitting, static and ‚Äúdynamic‚Äù imports, both using <a href="https://v8.dev/features/dynamic-import">dynamic imports es2020 feature</a></p>
<h3>Static import</h3>
<ul>
<li>Good to use when importing heavy javascript libraries/modules</li>
<li>Anything temporal - things that aren‚Äôt visible all the time on your page, tooltip, modal/dialog and even the rest of the page that comes only on scroll could be considered temporal</li>
<li>Routes</li>
</ul>
<p>To use static imports on your code just do: </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'path/to/myModule.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Or, even better, making a function to import the module when necessary, the import of the file itself is made just one time, then is cached and the next time calling the function the module is returned instantly, e.g:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> getModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> ‚áí <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'path/to/myModule.js'</span><span class="token punctuation">)</span>

<span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h3>Dynamic import</h3>
<p>‚ÄúDynamic‚Äù imports aren‚Äôt really dynamic since they are made at build time. Using dynamic imports it‚Äôs like saying to Webpack: Hey Webpack, please do all possibilities of chunks in this specific path at build time. So in this way, we can pass the chunk file that we wanna import using variables which makes this process kinda dynamic.</p>
<p>Considering we have a folder of themes like:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">themes
  ‚îî‚îÄ‚îÄ dark<span class="token punctuation">.</span>js
  ‚îî‚îÄ‚îÄ light<span class="token punctuation">.</span>js</code></pre></div>
<p>As an example we can do like:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> getTheme <span class="token operator">=</span> <span class="token punctuation">(</span>theme<span class="token punctuation">)</span> ‚áí <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path/to/themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">theme</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>This way webpack will create chunks for each theme file inside the themes folder, this technique is called <code class="language-text">ContextModule</code> into webpack code. </p>
<h2>Magic comments</h2>
<h3>webpackChunkName</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "my-chunk-name" */</span> <span class="token string">'path/to/myModule.js'</span><span class="token punctuation">)</span></code></pre></div>
<p>By default webpack creates chunk names following a numeral order, 1.js, 2.js, 3.js which makes the process of debugging harder to recognize which file was imported. using <code class="language-text">webpackChunkName</code> we can rename the chunk file, it‚Äôs important to remember that for this magic comment work we should be using the config <code class="language-text">output.chunkFileName: [name].whateverDoYouWantHere.js</code> on webpack.config file.</p>
<p>this is only helpful on dev mode, so we can do like:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "my-chunk-name" */</span> <span class="token string">'path/to/myModule.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'path/to/myModule.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-text">if</code> part will be removed if the build is running in production mode, and the <code class="language-text">else</code> part if in dev mode. This is known as dead-code elimination, tools like Uglify.js and others do that to reduce bundle size.</p>
<h3>webpackMode</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackMode: "lazy" */</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path/to/themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code></pre></div>
<p>the magic comment webpackMode has four types of value:</p>
<ul>
<li>lazy: generate chunks for each dynamic imported module, perfect choice to be used in production mode.</li>
<li>lazy-once: generate a single chunk that can satisfy all calls to import statement, perfect  choice to dev mode reducing the ‚Äúbundling‚Äù time.</li>
<li>eager: generates no extra chunk, all modules are included in the current chunk and no additional network requests are made. </li>
<li>weak: this is useful for universal rendering when required chunks are always manually served in initial requests, a Promise is still returned, but only successfully resolves if the chunks are already with the client. If the module is not available, the Promise is rejected. A network request will never be performed</li>
</ul>
<h3>Prefetch and Preload</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path/to/themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackLoad: true */</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path/to/themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code></pre></div>
<p>both comments above will create a link tag with <code class="language-text">rel=prefetch</code> or <code class="language-text">rel=preload</code> automatically for you, prefetching or preloading your chunks depends on the situation. if you don‚Äôt know what prefetch and preload links do, I highly recommend you to read that post <a href="https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf">Preload, Prefetch And Priorities in Chrome</a>.</p>
<p>This were my notes of <a href="https://frontendmasters.com/courses/performance-webpack/">Web performance with webpack</a> course, I hope you have learned something new today, see you next time! ‚ù§Ô∏è</p></div><section class="blog-post-module--disqus-container--1fggW"><div id="disqus_thread"></div></section></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-144025823-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/en/mastering-code-splitting-with-webpack/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ca8adf9770cfeec4c092.js"],"app":["/app-41047341e2e61b8de57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a4e36d6fb5a234338a2c.js"],"component---src-pages-pt-br-js":["/component---src-pages-pt-br-js-1b32ceebc259077e185a.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"]};/*]]>*/</script><script src="/blog/polyfill-ca8adf9770cfeec4c092.js" nomodule=""></script><script src="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js" async=""></script><script src="/blog/commons-9c8d01ef9560c35d21d1.js" async=""></script><script src="/blog/styles-407fe62976dc5310c43e.js" async=""></script><script src="/blog/app-41047341e2e61b8de57d.js" async=""></script><script src="/blog/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/blog/webpack-runtime-b11e3e4497b6e9cbf82d.js" async=""></script></body></html>