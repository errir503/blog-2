<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><script src="https://fast.appcues.com/88539.js"></script><script src="https://dielduarte.dev/blog/onrouteupdate.js"></script><style data-href="/blog/styles.400e59807eab519e537c.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.FloatMenu-module--menu--3DIQJ{position:fixed;bottom:-1px;right:0;cursor:pointer;padding:20px;width:100%;background:#fff;transform:translateY(187px);color:#22272c;transition:transform .2s,background .2s,color .2s}.FloatMenu-module--option--Fgcwy{transition:transform .2s;margin-right:10px;border:none;background:transparent;display:inline-block}.FloatMenu-module--option--Fgcwy:hover{cursor:pointer;transform:scale(1.2)}.FloatMenu-module--flag--1gcwG{width:30px;border-radius:4px}.FloatMenu-module--vader--PLIU6{width:34px;height:30px}.FloatMenu-module--trooper--OWxUE{width:28px}.FloatMenu-module--title--21W0t{padding-right:20px}.FloatMenu-module--subtitle--PTEKX{margin-top:20px;margin-bottom:10px}.FloatMenu-module--avatar--2Zizz{cursor:pointer;position:absolute;top:-37px;z-index:999999999;width:50px;right:20px;transition:top .2s}.FloatMenu-module--avatar--2Zizz:hover{top:-55px}.FloatMenu-module--openSettings--2rlaT{visibility:hidden}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ{transform:translateY(0)}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ .FloatMenu-module--avatar--2Zizz:hover{top:-37px}body.light-theme .FloatMenu-module--menu--3DIQJ{background:#22272c;color:#fff}@media(max-width:780px){.FloatMenu-module--menu--3DIQJ{transform:translateY(202px)}.FloatMenu-module--avatar--2Zizz{right:10px}}*{margin:0;padding:0;box-sizing:border-box;font-family:Press Start\ 2P,cursive}body{background:#22272c;color:#fff;transition:background .2s,color .2s}body.light-theme{color:#22272c;background:#fff}.global-module--container--ny7W9{max-width:1020px;margin:0 auto}.global-module--prefetchLink--hIA84{visibility:hidden;font-size:0}.PostList-module--posts--2R_sN{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:20px}.PostList-module--post--13-tS{width:calc(33.33% - 20px);background-color:#404447;padding:20px 20px 30px;box-shadow:none;text-decoration:none;position:relative;color:#fff;min-height:220px}.PostList-module--title--3NqQ3{text-decoration:none;font-size:13px;margin-bottom:20px;line-height:1.9em;min-height:48px}.PostList-module--description--39upC{font-family:Roboto,sans-serif;font-size:14px;line-height:1.5em}.PostList-module--date--3Ygsq{font-size:8px;position:absolute;bottom:10px;right:20px;padding:4px}@media(max-width:1040px){.PostList-module--posts--2R_sN{padding:0 20px}}@media(max-width:780px){.PostList-module--posts--2R_sN{display:block}.PostList-module--post--13-tS{display:block;width:100%;margin-right:0;margin-bottom:20px}}.blog-post-module--root--hhWTX{max-width:780px}.blog-post-module--content--c97Ib{padding-bottom:60px;margin:0 auto}.blog-post-module--content--c97Ib *{font-family:Roboto,sans-serif;font-size:18px;line-height:1.58em}.blog-post-module--content--c97Ib p{margin:30px 0}.blog-post-module--content--c97Ib h1,.blog-post-module--content--c97Ib h2,.blog-post-module--content--c97Ib h3,.blog-post-module--content--c97Ib h4,.blog-post-module--content--c97Ib h5,.blog-post-module--content--c97Ib h6{font-family:Press Start\ 2P,cursive;margin:30px 0}.blog-post-module--content--c97Ib h2{font-size:20px}.blog-post-module--content--c97Ib h3{font-size:14px}.subtitle--separator:before{content:". . .";display:block;width:100%;text-align:center;margin-bottom:50px;margin-top:50px}.language-text{color:#d78838!important;border:1px solid #3c3e42;padding:0 4px;border-radius:4px}.language-js,.language-js span{font-family:Fira Code,monospace!important}.blog-post-module--content--c97Ib a{display:inline-block;color:#d78838}.blog-post-module--content--c97Ib ol,.blog-post-module--content--c97Ib ul{margin:20px 0;list-style:none}.blog-post-module--content--c97Ib ul li{margin-bottom:10px}.blog-post-module--content--c97Ib ul li:before{content:"=>";font-family:Press Start\ 2P,cursive;font-size:10px;padding-right:10px;color:#d78838}.blog-post-module--content--c97Ib blockquote{border-left:4px solid #3e7068;padding-left:10px;margin:40px 0 40px 18px}.blog-post-module--content--c97Ib img,.blog-post-module--content--c97Ib video{max-width:100%;-o-object-fit:cover;object-fit:cover;display:block;margin:0 auto}@media(max-width:1040px){.blog-post-module--content--c97Ib{padding:1.4em}}.blog-post-module--disqus-container--1fggW{padding:0}@media(max-width:780px){.blog-post-module--disqus-container--1fggW{padding:0 1.4em}}.BackButton-module--button--NQDXr{font-size:18px;color:#fff;background:transparent;border:none;margin-top:20px;text-decoration:none;display:block;position:relative;transition:left .3s;left:0}.BackButton-module--button--NQDXr:hover{left:-4px}body.light-theme .BackButton-module--button--NQDXr{color:#22272c}@media(max-width:1040px){.BackButton-module--button--NQDXr{padding-left:12px}}.layout-module--title--2pFnw{font-size:24px;text-align:center;padding:50px 20px 30px;line-height:34px}.layout-module--link--9VMjY{box-shadow:none;text-decoration:none;color:inherit}@media(max-width:780px){.layout-module--title--2pFnw{padding:70px 20px 60px}}</style><meta name="generator" content="Gatsby 2.27.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8e659aea3a609f7031f6051b55e1472a" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8e659aea3a609f7031f6051b55e1472a"/><title data-react-helmet="true">Criando sua primeira aplicação com React e Xstate | Diel Duarte blog</title><meta data-react-helmet="true" name="description" content="Construindo sua primeira aplicação com react e xstate..."/><meta data-react-helmet="true" property="og:title" content="Criando sua primeira aplicação com React e Xstate"/><meta data-react-helmet="true" property="og:description" content="Construindo sua primeira aplicação com react e xstate..."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://dielduarte.dev/blog/images/creating-your-first-application-with-react-and-xstate/cats-app-machine.png"/><meta data-react-helmet="true" property="twitter:image" content="https://dielduarte.dev/blog/images/creating-your-first-application-with-react-and-xstate/cats-app-machine.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Diel Duarte"/><meta data-react-helmet="true" name="twitter:title" content="Criando sua primeira aplicação com React e Xstate"/><meta data-react-helmet="true" name="twitter:description" content="Construindo sua primeira aplicação com react e xstate..."/><link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Roboto|Fira+Code&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/blog/webpack-runtime-fc0a837832c8b8e1b2f1.js"/><link as="script" rel="preload" href="/blog/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/blog/app-41047341e2e61b8de57d.js"/><link as="script" rel="preload" href="/blog/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/blog/commons-9c8d01ef9560c35d21d1.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"/><link as="fetch" rel="preload" href="/blog/page-data/pt-br/criando-sua-primeira-aplicacao-com-react-e-xstate/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-module--container--ny7W9 blog-post-module--root--hhWTX"><a class="BackButton-module--button--NQDXr" href="/blog/">&lt;=</a><header><h1 class="layout-module--title--2pFnw">Criando sua primeira aplicação com React e Xstate</h1></header><main><a class="global-module--prefetchLink--hIA84" href="/blog/en/creating-your-first-application-with-react-and-xstate">/en/creating-your-first-application-with-react-and-xstate</a><div class="blog-post-module--content--c97Ib"><p>Hoje vamos criar nossa primeira aplicação utilizando o nosso modelo do post anterior que você pode ler <a href="/blog/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/">aqui</a>. Nós iremos utilizar Snowpack, React e Xstate.</p>
<p>Instalando dependências</p>
<p>Vamos utilizar o Snowpack como nosso sistema de build, e por que? Uma breve explicação pois isso daria um post separado é que o Snowpack é um sistema de build que utiliza o poder dos ESmodules em desenvolvimento, a ideia é que com ESmodules nós não precisamos de um builder em tempo de desenvolvimento já que os browsers modernos conseguem importar esmodules, isso faz com que sua ferramenta de desenvolvimento seja constante O(1) para startar seu dev server e tbm para fazer reloads ignorando o tamanho do seu projeto. Como disse isso daria um post separado que vamos ter em breve aqui no blog!</p>
<p>Instalando usando o create-snowpack-app:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">npx create<span class="token operator">-</span>snowpack<span class="token operator">-</span>app cats<span class="token operator">-</span>app <span class="token operator">--</span>template @snowpack<span class="token operator">/</span>app<span class="token operator">-</span>template<span class="token operator">-</span>react <span class="token operator">--</span>use<span class="token operator">-</span>yarn</code></pre></div>
<p>Esse comando vai criar uma pasta chamada <code class="language-text">cats-app</code> com todo o boilerplate inicial para iniciar um projeto Snowpack e React. Você vai perceber abrindo o projeto que a estrutura é bem parecida com a estrutura inicial do create-react-app, então se vc já usou create-react-app alguma vez vai estar bem familiarizado.</p>
<p>Como disse o projeto é muito simples e a ideia aqui não é se preocupar muito com UX, eu vou utilizar nos exemplos um pouco de Taiwlind só pra deixar um pouquinho mais bonitinho, mas sendo sincero nem precisava. Basicamente nosso projeto vai conter um botão para buscar uma nova imagem, mensagem de loading ou quando algum erro acontecer e uma imagem que vai ser rederizada quando buscarmos uma nova foto de gatinho.</p>
<p>Iniciando o projeto, entre na pasta <code class="language-text">cats-app</code> e rode:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">yarn start</code></pre></div>
<p>Vamos entrar no nosso app.js e remover tudo deixando o arquivo assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>também vamos ir em <code class="language-text">public/index.html</code> e importar o Tawilind, lembrando que essa não é a melhor maneira de utilizá-lo pois dessa forma estamos importando o código inteiro e vamos utilizar nem 10% das classes disponíveis. Mas o propósito aqui não é pensar em uma aplicação performática, então serve muito bem para exemplos:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span></code></pre></div>
<h3>Utilizando nossa machine do exemplo anterior:</h3>
<p>Primeiro precisamos instalar o xstate e @xstate/react</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  yarn add xstate @xstate<span class="token operator">/</span>react</code></pre></div>
<p>Vamos agora criar um arquivo src/app-machine.js, que vai conter a nossa machine que criamos no post anterior. </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Machine<span class="token punctuation">,</span> assign <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> AppMachine <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
  initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    currentImageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    retryTimes<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  states<span class="token operator">:</span> <span class="token punctuation">{</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> <span class="token punctuation">{</span>
      invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
        onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onError<span class="token operator">:</span> <span class="token string">'error'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    success<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'final'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
 services<span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.thecatapi.com/v1/images/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     headers<span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token string">'x-api-key'</span><span class="token operator">:</span> <span class="token string">'sua-api-key'</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 actions<span class="token operator">:</span> <span class="token punctuation">{</span>
   setCurrentImageUrl<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">currentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> event<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>url
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   resetRetryTimes<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   incrementRetryTimes<span class="token operator">:</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token function-variable function">retryTimes</span><span class="token operator">:</span>  <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 guards<span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">canRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>retryTimes <span class="token operator">&lt;</span> <span class="token number">2</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Você também vai precisar ir no site <a href="https://thecatapi.com">thecatapi.com</a> e gerar uma API key. Você deve substituir <code class="language-text">sua-api-key</code> pelo valor real na linha 51. </p>
<p>Se você está confuso como a machine funciona ou não leu a série inteira volte no post modelando sua primeira aplicação onde montamos essa state machine do zero.</p>
<p>Agora vamos voltar ao nosso app.js e vamos importar useMachine hook e nossa machine para que possamos utilizala no nosso app:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@xstate/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app-machine'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>current<span class="token punctuation">,</span> send<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMachine</span><span class="token punctuation">(</span>AppMachine<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Você consegue ver que useMachine hook retorna um array com dois items, o primeiro é tudo relacionado ao nosso estado atual + algumas funções úteis que podemos utilizar durante o desenvolvimento. O segundo é o metodo que chamamos de send, que é utilizado para enviar eventos para a machine, bem parecido com um dispatch do Redux.</p>
<p>Agora vamos montar nosso render, a princípio precisamos de um simples botão que envia  o evento <code class="language-text">LOAD_NEW_PICTURE</code> para nossa machine: o código ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@xstate/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app-machine'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>current<span class="token punctuation">,</span> send<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMachine</span><span class="token punctuation">(</span>AppMachine<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button 
        className<span class="token operator">=</span><span class="token string">"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"</span> 
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'LOAD_NEW_PICTURE'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token keyword">get</span> <span class="token keyword">new</span> <span class="token class-name">picture</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Agora nós precisamos tratar na nossa UI os quatro estados possíveis que nossa machine pode ter que é loading, success, errror, cant_retry. A fins didáticos vamos colocar tudo no render do App.js poderiamos melhorar esse código utilizando um pattern matching e separando cada variação em um componente diferente, mas o proposito aqui é ser simples. </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@xstate/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app-machine'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>current<span class="token punctuation">,</span> send<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMachine</span><span class="token punctuation">(</span>AppMachine<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button 
        className<span class="token operator">=</span><span class="token string">"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"</span> 
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'LOAD_NEW_PICTURE'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">></span>
      buscar uma nova foto
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>

      <span class="token punctuation">{</span>current<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>h3 className<span class="token operator">=</span><span class="token string">"text-xl text-purple-700 pt-4"</span><span class="token operator">></span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
      
      <span class="token punctuation">{</span>current<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>img className<span class="token operator">=</span><span class="token string">"pt-4 pr-4 object-cover w-full h-auto"</span> src<span class="token operator">=</span><span class="token punctuation">{</span>current<span class="token punctuation">.</span>context<span class="token punctuation">.</span>currentImageUrl<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>

      <span class="token punctuation">{</span>current<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">"text-lg text-red-700 mb-2 mt-2"</span><span class="token operator">></span>Ops<span class="token operator">!</span> algo deu errado<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
          <span class="token operator">&lt;</span>button 
            className<span class="token operator">=</span><span class="token string">"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"</span>  
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'RETRY'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">></span>
            tentar novamente
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>

      <span class="token punctuation">{</span>current<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">'cant_retry'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">N</span>ão é possível tentar novamente<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Nossa que tanto de IF Diel, o que está acontecendo? hahaha o mais legal do Xstate e State Machines no geral é que nós temos certeza que a aplicação nunca vai estar em mais de 1 estado ao mesmo tempo. Nós estamos utilizando o <code class="language-text">current.matches</code> que basicamente é uma função que retorna true se o estado passado como parâmetro der match com o estado atual da machine.</p>
<p>Nossa aplicação está praticamente pronta, e agora vem a cereja do bolo. Já pensou em poder vizualizar seu código e sua aplicação no geral em realtime podendo ter certeza do que está acontecendo na sua aplicação naquele momento? E mais, podendo controlar a sua aplicação por essa representação visual da mesma?</p>
<p>A poucas semanas a galera do Xstate lançou o xstate/inspect, que basicamente abre um debugger da sua aplicação representando a machine em tempo real e totalmente dinâmico, ou seja, você consegue controlar sua aplicação através desse debugger. Vamos ver como isso funciona:</p>
<p>Primeiro vamos instalar o inspect:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">yarn add @xstate<span class="token operator">/</span>inspect</code></pre></div>
<p>No nosso app.js vamos importar e iniciar a config inicial:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> inspect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@xstate/inspect"</span><span class="token punctuation">;</span>

<span class="token function">inspect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">"https://statecharts.io/inspect"</span><span class="token punctuation">,</span>
  iframe<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>E no nosso useMachine hook, vamos colocar um segundo parametro <code class="language-text">{ devTools: true }</code></p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>current<span class="token punctuation">,</span> send<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMachine</span><span class="token punctuation">(</span>AppMachine<span class="token punctuation">,</span> <span class="token punctuation">{</span> devTools<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Agora voltamos pra nossa aplicação e você vai ver que ao renderizá-la novamente o xstate/inspect vai abrir uma nova aba renderizando a sua machine em realtime e você pode tanto usar a sua aplicação e ver os resultados disso na aba do inspect quanto ao contrário, você pode enviar eventos do inspect para a sua aplicação.</p>
<video controls="true" allowfullscreen="true">
    <source src="/blog/images/creating-your-first-application-with-react-and-xstate/video-1.mp4" type="video/mp4">
  </video>
<h3>Simulando API retornando erro.</h3>
<p>Para sirmularmos nossa api retornando erro, vamos substituir nosso service <code class="language-text">fetchNewPicture</code> pelo código abaixo, que é que uma promisse sendo rejeitada:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Agora ao clicar em buscar uma nova foto, automaticamente vamos ser redirecionados para o estado de error. O mais legal de State Machines e da lib Xstate por ter implementado isso é que se um evento não é tratado no estado atual, mesmo que o usuário envie esse evento, nada acontece. </p>
<p>De propósito eu deixei o botão buscar uma nova foto disponÍvel sempre, tenta clicar nele 10 mil vezes você vai ver que nada acontece pois o evento LOAD<em>NEW</em>PICTURE não existe no estado de error.</p>
<p>Podemos ver também que nossa lógica de retry times funcionou, o usuário pode tentar novamente por 3 vezes, se por 3 vezes a api não retornou com sucesso o usuário é enviado para o estado cant_retry que é o estado final da nossa machine.</p>
<video controls="true" allowfullscreen="true">
    <source src="/blog/images/creating-your-first-application-with-react-and-xstate/video-2.mp4" type="video/mp4">
  </video>
<p>Por hoje é só pessoal!</p></div><section class="blog-post-module--disqus-container--1fggW"><div id="disqus_thread"></div></section></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-144025823-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/pt-br/criando-sua-primeira-aplicacao-com-react-e-xstate/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ca8adf9770cfeec4c092.js"],"app":["/app-41047341e2e61b8de57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a4c8c90d54199b46c394.js"],"component---src-pages-pt-br-js":["/component---src-pages-pt-br-js-0a783226c21806dbdbec.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"]};/*]]>*/</script><script src="/blog/polyfill-ca8adf9770cfeec4c092.js" nomodule=""></script><script src="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js" async=""></script><script src="/blog/commons-9c8d01ef9560c35d21d1.js" async=""></script><script src="/blog/styles-407fe62976dc5310c43e.js" async=""></script><script src="/blog/app-41047341e2e61b8de57d.js" async=""></script><script src="/blog/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/blog/webpack-runtime-fc0a837832c8b8e1b2f1.js" async=""></script></body></html>