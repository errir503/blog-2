<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.24b4a7ab24971c9ba768.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.FloatMenu-module--menu--3DIQJ{position:fixed;bottom:-1px;right:0;cursor:pointer;padding:20px;width:100%;background:#fff;transform:translateY(187px);color:#22272c;transition:transform .2s,background .2s,color .2s}.FloatMenu-module--option--Fgcwy{transition:transform .2s;margin-right:10px;border:none;background:transparent;display:inline-block}.FloatMenu-module--option--Fgcwy:hover{cursor:pointer;transform:scale(1.2)}.FloatMenu-module--flag--1gcwG{width:30px;border-radius:4px}.FloatMenu-module--vader--PLIU6{width:34px;height:30px}.FloatMenu-module--trooper--OWxUE{width:28px}.FloatMenu-module--title--21W0t{padding-right:20px}.FloatMenu-module--subtitle--PTEKX{margin-top:20px;margin-bottom:10px}.FloatMenu-module--avatar--2Zizz{cursor:pointer;position:absolute;top:-37px;z-index:999999999;width:50px;right:20px;transition:top .2s}.FloatMenu-module--avatar--2Zizz:hover{top:-55px}.FloatMenu-module--openSettings--2rlaT{visibility:hidden}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ{transform:translateY(0)}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ .FloatMenu-module--avatar--2Zizz:hover{top:-37px}body.light-theme .FloatMenu-module--menu--3DIQJ{background:#22272c;color:#fff}@media(max-width:780px){.FloatMenu-module--menu--3DIQJ{transform:translateY(202px)}.FloatMenu-module--avatar--2Zizz{right:10px}}*{margin:0;padding:0;box-sizing:border-box;font-family:Press Start\ 2P,cursive}body{background:#22272c;color:#fff;transition:background .2s,color .2s}body.light-theme{color:#22272c;background:#fff}.global-module--container--ny7W9{max-width:1020px;margin:0 auto}.global-module--prefetchLink--hIA84{visibility:hidden;font-size:0}.PostList-module--posts--2R_sN{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:20px}.PostList-module--post--13-tS{width:calc(33.33% - 20px);background-color:#404447;padding:20px 20px 30px;box-shadow:none;text-decoration:none;position:relative;color:#fff;min-height:220px}.PostList-module--title--3NqQ3{text-decoration:none;font-size:13px;margin-bottom:20px;line-height:1.9em;min-height:48px}.PostList-module--description--39upC{font-family:Roboto,sans-serif;font-size:14px;line-height:1.5em}.PostList-module--date--3Ygsq{font-size:8px;position:absolute;bottom:10px;right:20px;padding:4px}@media(max-width:1040px){.PostList-module--posts--2R_sN{padding:0 20px}}@media(max-width:780px){.PostList-module--posts--2R_sN{display:block}.PostList-module--post--13-tS{display:block;width:100%;margin-right:0;margin-bottom:20px}}.blog-post-module--root--hhWTX{max-width:780px}.blog-post-module--content--c97Ib{padding-bottom:60px;margin:0 auto}.blog-post-module--content--c97Ib *{font-family:Roboto,sans-serif;font-size:18px;line-height:1.58em}.blog-post-module--content--c97Ib p{margin:30px 0}.blog-post-module--content--c97Ib h1,.blog-post-module--content--c97Ib h2,.blog-post-module--content--c97Ib h3,.blog-post-module--content--c97Ib h4,.blog-post-module--content--c97Ib h5,.blog-post-module--content--c97Ib h6{font-family:Press Start\ 2P,cursive;margin:30px 0}.blog-post-module--content--c97Ib h2{font-size:20px}.blog-post-module--content--c97Ib h3{font-size:14px}.subtitle--separator:before{content:". . .";display:block;width:100%;text-align:center;margin-bottom:50px;margin-top:50px}.language-text{color:#d78838!important;border:1px solid #3c3e42;padding:0 4px;border-radius:4px}.language-js,.language-js span{font-family:Fira Code,monospace!important}.blog-post-module--content--c97Ib a{display:inline-block;color:#d78838}.blog-post-module--content--c97Ib ol,.blog-post-module--content--c97Ib ul{margin:20px 0;list-style:none}.blog-post-module--content--c97Ib ul li{margin-bottom:10px}.blog-post-module--content--c97Ib ul li:before{content:"=>";font-family:Press Start\ 2P,cursive;font-size:10px;padding-right:10px;color:#d78838}.blog-post-module--content--c97Ib blockquote{border-left:4px solid #3e7068;padding-left:10px;margin:40px 0 40px 18px}.blog-post-module--content--c97Ib img{max-width:100%;-o-object-fit:cover;object-fit:cover;display:block;margin:0 auto}@media(max-width:1040px){.blog-post-module--content--c97Ib{padding:1.4em}}.blog-post-module--disqus-container--1fggW{padding:0}@media(max-width:780px){.blog-post-module--disqus-container--1fggW{padding:0 1.4em}}.BackButton-module--button--NQDXr{font-size:18px;color:#fff;background:transparent;border:none;margin-top:20px;text-decoration:none;display:block;position:relative;transition:left .3s;left:0}.BackButton-module--button--NQDXr:hover{left:-4px}body.light-theme .BackButton-module--button--NQDXr{color:#22272c}@media(max-width:1040px){.BackButton-module--button--NQDXr{padding-left:12px}}.layout-module--title--2pFnw{font-size:24px;text-align:center;padding:50px 20px 30px;line-height:34px}.layout-module--link--9VMjY{box-shadow:none;text-decoration:none;color:inherit}@media(max-width:780px){.layout-module--title--2pFnw{padding:70px 20px 60px}}</style><meta name="generator" content="Gatsby 2.27.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8e659aea3a609f7031f6051b55e1472a" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8e659aea3a609f7031f6051b55e1472a"/><title data-react-helmet="true">Modelando sua primeira aplica√ß√£o com Statecharts e Xstate | Diel Duarte blog</title><meta data-react-helmet="true" name="description" content="Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate..."/><meta data-react-helmet="true" property="og:title" content="Modelando sua primeira aplica√ß√£o com Statecharts e Xstate"/><meta data-react-helmet="true" property="og:description" content="Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate..."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://dielduarte.dev/blog/images/web-development-with-state-charts-intro/image-7.png"/><meta data-react-helmet="true" property="twitter:image" content="https://dielduarte.dev/blog/images/web-development-with-state-charts-intro/image-7.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Diel Duarte"/><meta data-react-helmet="true" name="twitter:title" content="Modelando sua primeira aplica√ß√£o com Statecharts e Xstate"/><meta data-react-helmet="true" name="twitter:description" content="Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate..."/><link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Roboto|Fira+Code&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/blog/webpack-runtime-afd5e85def11657c3dfa.js"/><link as="script" rel="preload" href="/blog/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/blog/app-41047341e2e61b8de57d.js"/><link as="script" rel="preload" href="/blog/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/blog/commons-887a419bdf88aca30d58.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"/><link as="fetch" rel="preload" href="/blog/page-data/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-module--container--ny7W9 blog-post-module--root--hhWTX"><a class="BackButton-module--button--NQDXr" href="/blog/">&lt;=</a><header><h1 class="layout-module--title--2pFnw">Modelando sua primeira aplica√ß√£o com Statecharts e Xstate</h1></header><main><a class="global-module--prefetchLink--hIA84" href="/blog/en/modeling-your-first-application-using-statecharts-and-xstate">/en/modeling-your-first-application-using-statecharts-and-xstate</a><div class="blog-post-module--content--c97Ib"><p>Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate. Os posts ser√£o quebrados em 2 partes:</p>
<ul>
<li>O post que voc√™ est√° lendo ser√° como modelar sua aplica√ß√£o utilizando Statecharts e Xstate/Viz onde vamos cubrir alguns dos principais conceitos de Statecharts.</li>
<li>Escrevendo sua aplica√ß√£o com React e Xstate</li>
</ul>
<p>Sem mais delongas, bora pro post de hoje!</p>
<p>Antes de come√ßarmos a modelar uma aplica√ß√£o, precisamos entender um pouco mais sobre alguns dos conceitos de Statecharts, vale lembrar tamb√©m que todos os exemplos ser√£o usando Xstate mas voc√™ n√£o precisa de nenhuma lib para come√ßar usar hoje mesmo. Durante o desenvolvimento do modelo, vamos cobrir os seguintes conceitos:</p>
<ul>
<li>context</li>
<li>state</li>
<li>invoke</li>
<li>actions</li>
<li>guards</li>
</ul>
<p>Uma das features mais legais do Xstate √© poder vizualizar seu c√≥digo, hoje vamos usar o xstate/viz que vai nos ajudar a criar nosso modelo. Antes de mais nada, abra o seguinte link: xstate/viz , voc√™ provavelmente ver√° uma p√°gina igual a da imagem abaixo, ele ir√° iniciar com uma fetch machine e com o c√≥digo do exemplo do lado direito.</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-1.png" alt="imagem mostrando o xstate/viz aberto com uma fetch machine."></p>
<p>A primeira coisa que vamos fazer √© atualizar o c√≥digo no Xstate/Viz para o c√≥digo abaixo e clicar em update:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>O c√≥digo acima √© o c√≥digo basico para iniciarmos uma nova State Machine, cada state machine recebe um id √∫nico, um estado inicial e claro, a lista de estados dispon√≠veis. O resultado ser√°:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-2.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>A primeira coisa a se fazer √© pensar em quais estados nossa aplica√ß√£o pode ter, nesse exemplo vamos criar uma aplica√ß√£o que, ao clicar em um bot√£o busca de uma API uma imagem de um gatinho. A aplica√ß√£o tamb√©m tratar√° errors na api, habilitando o usu√°rio a tentar novamente por 3 vezes consecutivas caso a API retorne errors.</p>
<p>Com essa breve descri√ß√£o podemos ent√£o dizer que nossa aplica√ß√£o ter√° os seguintes estados:</p>
<ul>
<li>idle</li>
<li>loading</li>
<li>success</li>
<li>error</li>
<li>cant_retry</li>
</ul>
<p>O resultado em c√≥digo ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>E o resultado no xstate/viz:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-3.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>N√£o se preocupe caso voc√™ esque√ßa de algum estado da primeira vez, aos poucos e com pr√°tica voc√™ vai pegando maldade e vai conseguir ser mais assertivo em quais estados sua aplica√ß√£o ou seu componente deve ter. Alterar caso precise √© mais simples do que parece, voc√™ pode usar o xstate/viz para te ajudar a vizualizar as mudan√ßas e testar todos os fluxos poss√≠veis.</p>
<p>Lembra do nosso diagrama de transi√ß√£o de estados falado no primeiro post dessa s√©rie, onde mostramos que come√ßando em um estado A ‚áí um vento X aconteceu ‚áí vamos para um estado B ? O pr√≥ximo passo √© definir quais eventos dentro do seu sistema for√ßa uma transi√ß√£o de estado. Exemplo, quando estamos no estado inicial (<strong>idle)</strong> podemos dizer que o evento <strong>LOAD<em>NEW</em>PICTURE</strong> for√ßa uma transi√ß√£o para o estado <strong>loading</strong> ou seja:</p>
<ul>
<li><strong>idle ‚áí LOAD<em>NEW</em>PICTURE ‚áí loading</strong></li>
<li><strong>loading ‚áí ON_DONE ‚áí sucess</strong></li>
<li><strong>loading ‚áí ON_ERROR ‚áí error</strong></li>
<li><strong>success ‚áí LOAD<em>NEW</em>PICTURE ‚áí loading</strong></li>
<li><strong>error ‚áí RETRY ‚áí loading</strong></li>
</ul>
<p>Em c√≥digo ficaria:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">ON_DONE</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          <span class="token constant">ON_ERROR</span><span class="token operator">:</span> <span class="token string">'error'</span>  
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>e no xstate/viz:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-4.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Vizualizar seu c√≥digo √© muito interessante, no exemplo acima, podemos ver nitidamente qual evento leva a aplica√ß√£o para outro estado e todos os fluxos poss√≠veis. E inclusive furos no sistema, veja como o estado cant_retry nunca acontecer√° pois nenhum evento for√ßa uma transi√ß√£o at√© ele ü§∑‚Äç‚ôÇÔ∏è mas calma, n√≥s vamos chegar l√°.</p>
<h3>Context</h3>
<p>Context √© uma feature da lib Xstate que ter permite salvar contextos din√¢micos dependendo do estado que sua aplica√ß√£o est√°. Context nesse caso √© o nosso famoso estado como estamos acostumados a usar com outras libs como Redux, Mobx, Context Api no caso de usar com React, ou at√© mesmo um simples componente state.</p>
<p>Nesse caso, nosso contexto ser√° a nossa foto atual para ser exibida e a quantidade de vezes que o usu√°rio tentou buscar uma nova foto em caso de erros, precisamos iniciar nossa machine com o contexto inicial, o c√≥digo ent√£o ficaria dessa forma:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">ON_DONE</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          <span class="token constant">ON_ERROR</span><span class="token operator">:</span> <span class="token string">'error'</span>  
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Perceba que nesse caso, n√£o temos nenhuma altera√ß√£o nos estados da aplica√ß√£o. Mas no xstate/viz se voc√™ abrir a aba chamada <code class="language-text">State</code> voc√™ pode ver que ele te mostra qual o estado atual da aplica√ß√£o e qual os valores do contexto naquele momento.</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-5.png" alt="imagem mostrando a aba state no xstate/viz"></p>
<h3>Trabalhando com a√ß√µes ass√≠ncronas</h3>
<p>Em qualquer aplica√ß√£o sempre teremos a√ß√µes que s√£o ass√≠ncronas e os resultados dessas a√ß√µes podem ou n√£o resultar em uma transi√ß√£o de estado. Usando Xstate chamamos isso de Services, e chamar um servi√ßo √© t√£o f√°cil e declarativo quanto qualquer outro conceito.</p>
<p>No nosso exemplo, o servi√ßo ser√° uma promise que vai fazer o request para buscar uma nova foto. O resultado dessa promise, se com sucesso ou erro gerara transi√ß√µes de estados. Pensando em um fluxo de dados quando a aplica√ß√£o sai do estado de ocioso(idle) para loading √© nesse momento que devemos ent√£o fazer nosso request. Preste bem aten√ß√£o no estado de loading no proximo exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> 
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Substitu√≠mos nossos eventos por uma key chamada <strong>invoke,</strong> que recebe nesse exemplo, 3 configura√ß√µes: </p>
<ul>
<li><strong>src</strong>:  √â uma fun√ß√£o que retorna uma promisse. No nosso c√≥digo estamos passando apenas o nome da fun√ß√£o que ser√° chamada  e como segundo par√¢metro da fun√ß√£o <strong>Machine</strong>, passamos um objeto com a key <strong>services</strong> que nada mais √© que outro objeto com todos os servi√ßos que podem ser chamados.</li>
<li><strong>onDone</strong>: Qual o pr√≥ximo estado vamos redirecionar nossa machine se tudo ocorrer bem.</li>
<li><strong>onError</strong>: Qual o pr√≥ximo estado vamos redirecionar nossa machine se algum erro acontecer.</li>
</ul>
<p>Vale lembrar que um servi√ßo pode ser uma promisse, observables, callback ou outra machine.</p>
<p>A vizualiza√ß√£o do nosso c√≥digo ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-6.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Da pra perceber que o viz coloca invoke / nome do servi√ßo dentro da quadradinho que representa o estado atual e tamb√©m o nome do servi√ßo dentro de um par√™nteses nos eventos simbolizando que aquele evento est√° relacionado ao servi√ßo chamado.</p>
<h3>Actions</h3>
<p>Actions s√£o fun√ß√µes do tipo fire-and-forget, ou seja, fun√ß√µes  que n√£o geram uma transi√ß√£o de estados. As actions por√©m, s√£o muito usadas para rodar qualquer tipo de side effect que podem atualizar nosso contexto.</p>
<p>No nosso exemplo, quando a promisse que busca uma nova foto retorna precisamos chamar uma action para atualizar o valor do nosso contexto currentImageUrl.</p>
<p>Qualquer transi√ß√£o de estado dentro do Xstate pode receber apenas uma string com o nome do novo estado ou um objeto de configura√ß√£o, onde passamos o target que representa o pr√≥ximo estado e outras configura√ß√µes como por exemplo, uma action. Nesse caso vamos alterar nosso invoke objeto para:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
  onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  onError<span class="token operator">:</span> <span class="token string">'error'</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Perceba que passamos apenas uma string que √© refer√™ncia para uma fun√ß√£o action, tamb√©m vamos passar a action no segundo parametro da fun√ß√£o Machine, dessa forma, eu acredito que fica mais simples de ler nossa machine. O c√≥digo final ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Uma action recebe por par√¢metro, o contexto atual e um event, esse event nada mais √© do que o retorno do servi√ßo, como nosso servi√ßo nesse caso √© uma promisse, nosso event ser√° o retorno dela. Caso nosso servi√ßo fosse um callback por ex, esse event seria a chamada do callback com qualquer informa√ß√£o adicional que o servi√ßo queira passar para a action.</p>
<p>A vizualiza√ß√£o do c√≥digo ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-7.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Perceba que o Viz coloca uma lista de a√ß√µes que acontecem quando um evento √© disparado com do / nome da action bem abaixo da representa√ß√£o visual de um evento.</p>
<p>Seguindo nosso exemplo, sempre que a promisse retornar um erro e o usu√°rio envia o evento RETRY devemos incrementar o valor de retryTimes no nosso contexto,  tamb√©m devemos resetar esse valor caso a promisse retorne com sucesso. Nesse caso, vamos adiconar uma action quando chamamos o evento RETRY e outra quando a promisse retorna com sucesso:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">'loading'</span>
            actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>A vizualiza√ß√£o do c√≥digo ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-8.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Agora voc√™ j√° sabe reconhecer quando uma action √© chamada apenas olhando a vizualiza√ß√£o do c√≥digo üöÄ.</p>
<h3>Guards</h3>
<p>Guards s√£o usados para garantir que uma transi√ß√£o de estado que depende de alguma regra de negocio seja feita com seguran√ßa, usando o nosso exemplo, quando a promisse que busca uma nova foto retorna um erro, o usu√°rio pode tentar buscar novamente por 3 vezes. Ao tentar 3 vezes e sem sucesso, o usu√°rio √© ent√£o redirecionado para um estado onde ele n√£o pode mais tentar buscar uma nova foto.</p>
<p>Para fazer isso acontecer iremos usar os guards, o jeito de configurar um guard √© bem simples, no nosso caso, o evento RETRY vai conter duas poss√≠veis branchs:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  error<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>Nesse caso nada acontece, pois ainda n√£o adicionamos o nosso guard, para adicionar um ou mais guards basta colocar uma key cond na branch que deve ser redirecionada apenas se o guard retornar true. As branchs s√£o sempre lidas por ordem que foram declaradas, ou seja, nesse caso vamos colocar nosso guard na primeira branch, caso o retorno do guard seja falso iremos ent√£o para a pr√≥xima op√ß√£o que vai ent√£o for√ßar uma transi√ß√£o de estado para o estado cant_retry,  nosso c√≥digo ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  error<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Novamente usamos a string para referenciar ao nome da fun√ß√£o guard que estar√° no segundo par√¢metro do m√©todo Machine, c√≥digo final ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
	          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
	        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
	        <span class="token punctuation">}</span>
	       <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   guards<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">canRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>retryTimes <span class="token operator">&lt;=</span> <span class="token number">3</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-9.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Perceba que agora nosso estado cant_retry tem uma liga√ß√£o com o evento Retry, e n√≥s temos dois eventos Retry que representam por ordem as branchs que declaramos. Perceba tamb√©m que a primeira branch dentro do evento tem um array de guards e os nomes dessas condi√ß√µes, um guard fica verde em caso retorne true e vermelho em caso retorne false representando que aquele evento n√£o vai acontecer.</p>
<h3>Type final</h3>
<p>Estados do tipo final, representam que aquela machine est√° terminada, ou seja, nenhum evento ou transi√ß√£o ir√° acontecer depois que a machine chegar a esse estado. No nosso exemplo, o estado cant_retry √© nosso estado final. Vale lembrar que uma machine n√£o necessariamente precisa ter um estado final.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
	          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
	        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
	        <span class="token punctuation">}</span>
	       <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'final'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   guards<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">canRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>retryTimes <span class="token operator">&lt;=</span> <span class="token number">3</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Bom modelar uma aplica√ß√£o parece divertido agora, principalmente sabendo que todo o c√≥digo que escrevemos nessa tarefa √© o mesmo c√≥digo que ser√° usado na aplica√ß√£o final. No pr√≥ximo post iremos de fato usar esse codigo e criar nossa aplica√ß√£o front-end usando react e xstate.</p>
<p>Te vejo l√°!</p></div><section class="blog-post-module--disqus-container--1fggW"><div id="disqus_thread"></div></section></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-144025823-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ca8adf9770cfeec4c092.js"],"app":["/app-41047341e2e61b8de57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a4c8c90d54199b46c394.js"],"component---src-pages-pt-br-js":["/component---src-pages-pt-br-js-0a783226c21806dbdbec.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"]};/*]]>*/</script><script src="/blog/polyfill-ca8adf9770cfeec4c092.js" nomodule=""></script><script src="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js" async=""></script><script src="/blog/commons-887a419bdf88aca30d58.js" async=""></script><script src="/blog/styles-407fe62976dc5310c43e.js" async=""></script><script src="/blog/app-41047341e2e61b8de57d.js" async=""></script><script src="/blog/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/blog/webpack-runtime-afd5e85def11657c3dfa.js" async=""></script></body></html>