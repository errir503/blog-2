<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.24b4a7ab24971c9ba768.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.FloatMenu-module--menu--3DIQJ{position:fixed;bottom:-1px;right:0;cursor:pointer;padding:20px;width:100%;background:#fff;transform:translateY(187px);color:#22272c;transition:transform .2s,background .2s,color .2s}.FloatMenu-module--option--Fgcwy{transition:transform .2s;margin-right:10px;border:none;background:transparent;display:inline-block}.FloatMenu-module--option--Fgcwy:hover{cursor:pointer;transform:scale(1.2)}.FloatMenu-module--flag--1gcwG{width:30px;border-radius:4px}.FloatMenu-module--vader--PLIU6{width:34px;height:30px}.FloatMenu-module--trooper--OWxUE{width:28px}.FloatMenu-module--title--21W0t{padding-right:20px}.FloatMenu-module--subtitle--PTEKX{margin-top:20px;margin-bottom:10px}.FloatMenu-module--avatar--2Zizz{cursor:pointer;position:absolute;top:-37px;z-index:999999999;width:50px;right:20px;transition:top .2s}.FloatMenu-module--avatar--2Zizz:hover{top:-55px}.FloatMenu-module--openSettings--2rlaT{visibility:hidden}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ{transform:translateY(0)}.FloatMenu-module--openSettings--2rlaT:checked~.FloatMenu-module--menu--3DIQJ .FloatMenu-module--avatar--2Zizz:hover{top:-37px}body.light-theme .FloatMenu-module--menu--3DIQJ{background:#22272c;color:#fff}@media(max-width:780px){.FloatMenu-module--menu--3DIQJ{transform:translateY(202px)}.FloatMenu-module--avatar--2Zizz{right:10px}}*{margin:0;padding:0;box-sizing:border-box;font-family:Press Start\ 2P,cursive}body{background:#22272c;color:#fff;transition:background .2s,color .2s}body.light-theme{color:#22272c;background:#fff}.global-module--container--ny7W9{max-width:1020px;margin:0 auto}.global-module--prefetchLink--hIA84{visibility:hidden;font-size:0}.PostList-module--posts--2R_sN{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:20px}.PostList-module--post--13-tS{width:calc(33.33% - 20px);background-color:#404447;padding:20px 20px 30px;box-shadow:none;text-decoration:none;position:relative;color:#fff;min-height:220px}.PostList-module--title--3NqQ3{text-decoration:none;font-size:13px;margin-bottom:20px;line-height:1.9em;min-height:48px}.PostList-module--description--39upC{font-family:Roboto,sans-serif;font-size:14px;line-height:1.5em}.PostList-module--date--3Ygsq{font-size:8px;position:absolute;bottom:10px;right:20px;padding:4px}@media(max-width:1040px){.PostList-module--posts--2R_sN{padding:0 20px}}@media(max-width:780px){.PostList-module--posts--2R_sN{display:block}.PostList-module--post--13-tS{display:block;width:100%;margin-right:0;margin-bottom:20px}}.blog-post-module--root--hhWTX{max-width:780px}.blog-post-module--content--c97Ib{padding-bottom:60px;margin:0 auto}.blog-post-module--content--c97Ib *{font-family:Roboto,sans-serif;font-size:18px;line-height:1.58em}.blog-post-module--content--c97Ib p{margin:30px 0}.blog-post-module--content--c97Ib h1,.blog-post-module--content--c97Ib h2,.blog-post-module--content--c97Ib h3,.blog-post-module--content--c97Ib h4,.blog-post-module--content--c97Ib h5,.blog-post-module--content--c97Ib h6{font-family:Press Start\ 2P,cursive;margin:30px 0}.blog-post-module--content--c97Ib h2{font-size:20px}.blog-post-module--content--c97Ib h3{font-size:14px}.subtitle--separator:before{content:". . .";display:block;width:100%;text-align:center;margin-bottom:50px;margin-top:50px}.language-text{color:#d78838!important;border:1px solid #3c3e42;padding:0 4px;border-radius:4px}.language-js,.language-js span{font-family:Fira Code,monospace!important}.blog-post-module--content--c97Ib a{display:inline-block;color:#d78838}.blog-post-module--content--c97Ib ol,.blog-post-module--content--c97Ib ul{margin:20px 0;list-style:none}.blog-post-module--content--c97Ib ul li{margin-bottom:10px}.blog-post-module--content--c97Ib ul li:before{content:"=>";font-family:Press Start\ 2P,cursive;font-size:10px;padding-right:10px;color:#d78838}.blog-post-module--content--c97Ib blockquote{border-left:4px solid #3e7068;padding-left:10px;margin:40px 0 40px 18px}.blog-post-module--content--c97Ib img{max-width:100%;-o-object-fit:cover;object-fit:cover;display:block;margin:0 auto}@media(max-width:1040px){.blog-post-module--content--c97Ib{padding:1.4em}}.blog-post-module--disqus-container--1fggW{padding:0}@media(max-width:780px){.blog-post-module--disqus-container--1fggW{padding:0 1.4em}}.BackButton-module--button--NQDXr{font-size:18px;color:#fff;background:transparent;border:none;margin-top:20px;text-decoration:none;display:block;position:relative;transition:left .3s;left:0}.BackButton-module--button--NQDXr:hover{left:-4px}body.light-theme .BackButton-module--button--NQDXr{color:#22272c}@media(max-width:1040px){.BackButton-module--button--NQDXr{padding-left:12px}}.layout-module--title--2pFnw{font-size:24px;text-align:center;padding:50px 20px 30px;line-height:34px}.layout-module--link--9VMjY{box-shadow:none;text-decoration:none;color:inherit}@media(max-width:780px){.layout-module--title--2pFnw{padding:70px 20px 60px}}</style><meta name="generator" content="Gatsby 2.27.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=8e659aea3a609f7031f6051b55e1472a" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#fff"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=8e659aea3a609f7031f6051b55e1472a"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=8e659aea3a609f7031f6051b55e1472a"/><title data-react-helmet="true">Modelando sua primeira aplicação com Statecharts e Xstate | Diel Duarte blog</title><meta data-react-helmet="true" name="description" content="Nesse e nos próximos posts vamos contruir uma aplicação utilizando Statecharts e a ajuda da lib Xstate..."/><meta data-react-helmet="true" property="og:title" content="Modelando sua primeira aplicação com Statecharts e Xstate"/><meta data-react-helmet="true" property="og:description" content="Nesse e nos próximos posts vamos contruir uma aplicação utilizando Statecharts e a ajuda da lib Xstate..."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://dielduarte.dev/blog/images/web-development-with-state-charts-intro/image-7.png"/><meta data-react-helmet="true" property="twitter:image" content="https://dielduarte.dev/blog/images/web-development-with-state-charts-intro/image-7.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Diel Duarte"/><meta data-react-helmet="true" name="twitter:title" content="Modelando sua primeira aplicação com Statecharts e Xstate"/><meta data-react-helmet="true" name="twitter:description" content="Nesse e nos próximos posts vamos contruir uma aplicação utilizando Statecharts e a ajuda da lib Xstate..."/><link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Roboto|Fira+Code&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/blog/webpack-runtime-afd5e85def11657c3dfa.js"/><link as="script" rel="preload" href="/blog/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/blog/app-41047341e2e61b8de57d.js"/><link as="script" rel="preload" href="/blog/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/blog/commons-887a419bdf88aca30d58.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"/><link as="fetch" rel="preload" href="/blog/page-data/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-module--container--ny7W9 blog-post-module--root--hhWTX"><a class="BackButton-module--button--NQDXr" href="/blog/">&lt;=</a><header><h1 class="layout-module--title--2pFnw">Modelando sua primeira aplicação com Statecharts e Xstate</h1></header><main><a class="global-module--prefetchLink--hIA84" href="/blog/en/modeling-your-first-application-using-statecharts-and-xstate">/en/modeling-your-first-application-using-statecharts-and-xstate</a><div class="blog-post-module--content--c97Ib"><p>Nesse e nos próximos posts vamos contruir uma aplicação utilizando Statecharts e a ajuda da lib Xstate. Os posts serão quebrados em 2 partes:</p>
<ul>
<li>O post que você está lendo será como modelar sua aplicação utilizando Statecharts e Xstate/Viz onde vamos cubrir alguns dos principais conceitos de Statecharts.</li>
<li>Escrevendo sua aplicação com React e Xstate</li>
</ul>
<p>Sem mais delongas, bora pro post de hoje!</p>
<p>Antes de começarmos a modelar uma aplicação, precisamos entender um pouco mais sobre alguns dos conceitos de Statecharts, vale lembrar também que todos os exemplos serão usando Xstate mas você não precisa de nenhuma lib para começar usar hoje mesmo. Durante o desenvolvimento do modelo, vamos cobrir os seguintes conceitos:</p>
<ul>
<li>context</li>
<li>state</li>
<li>invoke</li>
<li>actions</li>
<li>guards</li>
</ul>
<p>Uma das features mais legais do Xstate é poder vizualizar seu código, hoje vamos usar o xstate/viz que vai nos ajudar a criar nosso modelo. Antes de mais nada, abra o seguinte link: xstate/viz , você provavelmente verá uma página igual a da imagem abaixo, ele irá iniciar com uma fetch machine e com o código do exemplo do lado direito.</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-1.png" alt="imagem mostrando o xstate/viz aberto com uma fetch machine."></p>
<p>A primeira coisa que vamos fazer é atualizar o código no Xstate/Viz para o código abaixo e clicar em update:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>O código acima é o código basico para iniciarmos uma nova State Machine, cada state machine recebe um id único, um estado inicial e claro, a lista de estados disponíveis. O resultado será:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-2.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>A primeira coisa a se fazer é pensar em quais estados nossa aplicação pode ter, nesse exemplo vamos criar uma aplicação que, ao clicar em um botão busca de uma API uma imagem de um gatinho. A aplicação também tratará errors na api, habilitando o usuário a tentar novamente por 3 vezes consecutivas caso a API retorne errors.</p>
<p>Com essa breve descrição podemos então dizer que nossa aplicação terá os seguintes estados:</p>
<ul>
<li>idle</li>
<li>loading</li>
<li>success</li>
<li>error</li>
<li>cant_retry</li>
</ul>
<p>O resultado em código ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>E o resultado no xstate/viz:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-3.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Não se preocupe caso você esqueça de algum estado da primeira vez, aos poucos e com prática você vai pegando maldade e vai conseguir ser mais assertivo em quais estados sua aplicação ou seu componente deve ter. Alterar caso precise é mais simples do que parece, você pode usar o xstate/viz para te ajudar a vizualizar as mudanças e testar todos os fluxos possíveis.</p>
<p>Lembra do nosso diagrama de transição de estados falado no primeiro post dessa série, onde mostramos que começando em um estado A ⇒ um vento X aconteceu ⇒ vamos para um estado B ? O próximo passo é definir quais eventos dentro do seu sistema força uma transição de estado. Exemplo, quando estamos no estado inicial (<strong>idle)</strong> podemos dizer que o evento <strong>LOAD<em>NEW</em>PICTURE</strong> força uma transição para o estado <strong>loading</strong> ou seja:</p>
<ul>
<li><strong>idle ⇒ LOAD<em>NEW</em>PICTURE ⇒ loading</strong></li>
<li><strong>loading ⇒ ON_DONE ⇒ sucess</strong></li>
<li><strong>loading ⇒ ON_ERROR ⇒ error</strong></li>
<li><strong>success ⇒ LOAD<em>NEW</em>PICTURE ⇒ loading</strong></li>
<li><strong>error ⇒ RETRY ⇒ loading</strong></li>
</ul>
<p>Em código ficaria:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">ON_DONE</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          <span class="token constant">ON_ERROR</span><span class="token operator">:</span> <span class="token string">'error'</span>  
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>e no xstate/viz:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-4.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Vizualizar seu código é muito interessante, no exemplo acima, podemos ver nitidamente qual evento leva a aplicação para outro estado e todos os fluxos possíveis. E inclusive furos no sistema, veja como o estado cant_retry nunca acontecerá pois nenhum evento força uma transição até ele 🤷‍♂️ mas calma, nós vamos chegar lá.</p>
<h3>Context</h3>
<p>Context é uma feature da lib Xstate que ter permite salvar contextos dinâmicos dependendo do estado que sua aplicação está. Context nesse caso é o nosso famoso estado como estamos acostumados a usar com outras libs como Redux, Mobx, Context Api no caso de usar com React, ou até mesmo um simples componente state.</p>
<p>Nesse caso, nosso contexto será a nossa foto atual para ser exibida e a quantidade de vezes que o usuário tentou buscar uma nova foto em caso de erros, precisamos iniciar nossa machine com o contexto inicial, o código então ficaria dessa forma:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">ON_DONE</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          <span class="token constant">ON_ERROR</span><span class="token operator">:</span> <span class="token string">'error'</span>  
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Perceba que nesse caso, não temos nenhuma alteração nos estados da aplicação. Mas no xstate/viz se você abrir a aba chamada <code class="language-text">State</code> você pode ver que ele te mostra qual o estado atual da aplicação e qual os valores do contexto naquele momento.</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-5.png" alt="imagem mostrando a aba state no xstate/viz"></p>
<h3>Trabalhando com ações assíncronas</h3>
<p>Em qualquer aplicação sempre teremos ações que são assíncronas e os resultados dessas ações podem ou não resultar em uma transição de estado. Usando Xstate chamamos isso de Services, e chamar um serviço é tão fácil e declarativo quanto qualquer outro conceito.</p>
<p>No nosso exemplo, o serviço será uma promise que vai fazer o request para buscar uma nova foto. O resultado dessa promise, se com sucesso ou erro gerara transições de estados. Pensando em um fluxo de dados quando a aplicação sai do estado de ocioso(idle) para loading é nesse momento que devemos então fazer nosso request. Preste bem atenção no estado de loading no proximo exemplo:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> 
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Substituímos nossos eventos por uma key chamada <strong>invoke,</strong> que recebe nesse exemplo, 3 configurações: </p>
<ul>
<li><strong>src</strong>:  É uma função que retorna uma promisse. No nosso código estamos passando apenas o nome da função que será chamada  e como segundo parâmetro da função <strong>Machine</strong>, passamos um objeto com a key <strong>services</strong> que nada mais é que outro objeto com todos os serviços que podem ser chamados.</li>
<li><strong>onDone</strong>: Qual o próximo estado vamos redirecionar nossa machine se tudo ocorrer bem.</li>
<li><strong>onError</strong>: Qual o próximo estado vamos redirecionar nossa machine se algum erro acontecer.</li>
</ul>
<p>Vale lembrar que um serviço pode ser uma promisse, observables, callback ou outra machine.</p>
<p>A vizualização do nosso código ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-6.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Da pra perceber que o viz coloca invoke / nome do serviço dentro da quadradinho que representa o estado atual e também o nome do serviço dentro de um parênteses nos eventos simbolizando que aquele evento está relacionado ao serviço chamado.</p>
<h3>Actions</h3>
<p>Actions são funções do tipo fire-and-forget, ou seja, funções  que não geram uma transição de estados. As actions porém, são muito usadas para rodar qualquer tipo de side effect que podem atualizar nosso contexto.</p>
<p>No nosso exemplo, quando a promisse que busca uma nova foto retorna precisamos chamar uma action para atualizar o valor do nosso contexto currentImageUrl.</p>
<p>Qualquer transição de estado dentro do Xstate pode receber apenas uma string com o nome do novo estado ou um objeto de configuração, onde passamos o target que representa o próximo estado e outras configurações como por exemplo, uma action. Nesse caso vamos alterar nosso invoke objeto para:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
  onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  onError<span class="token operator">:</span> <span class="token string">'error'</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Perceba que passamos apenas uma string que é referência para uma função action, também vamos passar a action no segundo parametro da função Machine, dessa forma, eu acredito que fica mais simples de ler nossa machine. O código final ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Uma action recebe por parâmetro, o contexto atual e um event, esse event nada mais é do que o retorno do serviço, como nosso serviço nesse caso é uma promisse, nosso event será o retorno dela. Caso nosso serviço fosse um callback por ex, esse event seria a chamada do callback com qualquer informação adicional que o serviço queira passar para a action.</p>
<p>A vizualização do código ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-7.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Perceba que o Viz coloca uma lista de ações que acontecem quando um evento é disparado com do / nome da action bem abaixo da representação visual de um evento.</p>
<p>Seguindo nosso exemplo, sempre que a promisse retornar um erro e o usuário envia o evento RETRY devemos incrementar o valor de retryTimes no nosso contexto,  também devemos resetar esse valor caso a promisse retorne com sucesso. Nesse caso, vamos adiconar uma action quando chamamos o evento RETRY e outra quando a promisse retorna com sucesso:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">'loading'</span>
            actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>A vizualização do código ficaria assim:</p>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-8.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Agora você já sabe reconhecer quando uma action é chamada apenas olhando a vizualização do código 🚀.</p>
<h3>Guards</h3>
<p>Guards são usados para garantir que uma transição de estado que depende de alguma regra de negocio seja feita com segurança, usando o nosso exemplo, quando a promisse que busca uma nova foto retorna um erro, o usuário pode tentar buscar novamente por 3 vezes. Ao tentar 3 vezes e sem sucesso, o usuário é então redirecionado para um estado onde ele não pode mais tentar buscar uma nova foto.</p>
<p>Para fazer isso acontecer iremos usar os guards, o jeito de configurar um guard é bem simples, no nosso caso, o evento RETRY vai conter duas possíveis branchs:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  error<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>Nesse caso nada acontece, pois ainda não adicionamos o nosso guard, para adicionar um ou mais guards basta colocar uma key cond na branch que deve ser redirecionada apenas se o guard retornar true. As branchs são sempre lidas por ordem que foram declaradas, ou seja, nesse caso vamos colocar nosso guard na primeira branch, caso o retorno do guard seja falso iremos então para a próxima opção que vai então forçar uma transição de estado para o estado cant_retry,  nosso código ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">  error<span class="token operator">:</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Novamente usamos a string para referenciar ao nome da função guard que estará no segundo parâmetro do método Machine, código final ficaria assim:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
	          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
	        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
	        <span class="token punctuation">}</span>
	       <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   guards<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">canRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>retryTimes <span class="token operator">&lt;=</span> <span class="token number">3</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><img src="/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-9.png" alt="imagem mostrando o resultado do codigo colado no xstate/viz"></p>
<p>Perceba que agora nosso estado cant_retry tem uma ligação com o evento Retry, e nós temos dois eventos Retry que representam por ordem as branchs que declaramos. Perceba também que a primeira branch dentro do evento tem um array de guards e os nomes dessas condições, um guard fica verde em caso retorne true e vermelho em caso retorne false representando que aquele evento não vai acontecer.</p>
<h3>Type final</h3>
<p>Estados do tipo final, representam que aquela machine está terminada, ou seja, nenhum evento ou transição irá acontecer depois que a machine chegar a esse estado. No nosso exemplo, o estado cant_retry é nosso estado final. Vale lembrar que uma machine não necessariamente precisa ter um estado final.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> catsApp <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'catsApp'</span><span class="token punctuation">,</span>
    initial<span class="token operator">:</span> <span class="token string">'idle'</span><span class="token punctuation">,</span>
	  context<span class="token operator">:</span> <span class="token punctuation">{</span>
	    currentImageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      retryTimes<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    states<span class="token operator">:</span> <span class="token punctuation">{</span>
      idle<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        invoke<span class="token operator">:</span> <span class="token punctuation">{</span>
	        src<span class="token operator">:</span> <span class="token string">'fetchNewPicture'</span><span class="token punctuation">,</span>
          onDone<span class="token operator">:</span> <span class="token punctuation">{</span>
				    target<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
				    actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'setCurrentImageUrl'</span><span class="token punctuation">,</span> <span class="token string">'resetRetryTimes'</span><span class="token punctuation">]</span>
				  <span class="token punctuation">}</span><span class="token punctuation">,</span>
          onError<span class="token operator">:</span> <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      success<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token constant">LOAD_NEW_PICTURE</span><span class="token operator">:</span> <span class="token string">'loading'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">{</span>
        on<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token constant">RETRY</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>
	          actions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'incrementRetryTimes'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	          cond<span class="token operator">:</span> <span class="token string">'canRetry'</span>
	        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
	        <span class="token punctuation">{</span>
	          target<span class="token operator">:</span> <span class="token string">'cant_retry'</span>
	        <span class="token punctuation">}</span>
	       <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      cant_retry<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'final'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   services<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">fetchNewPicture</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   actions<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">setCurrentImageUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       currentImageUrl<span class="token operator">:</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageUrl
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">resetRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> retryTimes<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function-variable function">incrementRetryTimes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
       retryTimes<span class="token operator">:</span>  context<span class="token punctuation">.</span>retryTimes <span class="token operator">+</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   guards<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">canRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=></span> context<span class="token punctuation">.</span>retryTimes <span class="token operator">&lt;=</span> <span class="token number">3</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Bom modelar uma aplicação parece divertido agora, principalmente sabendo que todo o código que escrevemos nessa tarefa é o mesmo código que será usado na aplicação final. No próximo post iremos de fato usar esse codigo e criar nossa aplicação front-end usando react e xstate.</p>
<p>Te vejo lá!</p></div><section class="blog-post-module--disqus-container--1fggW"><div id="disqus_thread"></div></section></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-144025823-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ca8adf9770cfeec4c092.js"],"app":["/app-41047341e2e61b8de57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a4c8c90d54199b46c394.js"],"component---src-pages-pt-br-js":["/component---src-pages-pt-br-js-0a783226c21806dbdbec.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js"]};/*]]>*/</script><script src="/blog/polyfill-ca8adf9770cfeec4c092.js" nomodule=""></script><script src="/blog/component---src-templates-blog-post-js-75fd52bd8a284827f8e6.js" async=""></script><script src="/blog/commons-887a419bdf88aca30d58.js" async=""></script><script src="/blog/styles-407fe62976dc5310c43e.js" async=""></script><script src="/blog/app-41047341e2e61b8de57d.js" async=""></script><script src="/blog/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/blog/webpack-runtime-afd5e85def11657c3dfa.js" async=""></script></body></html>