{"componentChunkName":"component---src-templates-blog-post-js","path":"/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/","result":{"data":{"site":{"siteMetadata":{"title":"Diel Duarte blog","author":"Diel Duarte","siteUrl":"https://dielduarte.dev","pt_br":{"rootPath":"/blog/pt-br","title":"Bem vindo ao meu blog!"},"en":{"rootPath":"/blog/","title":"Welcome to my blog!"}}},"markdownRemark":{"id":"95f2bbb0-78b1-5af0-b5a7-4c1458a4e460","excerpt":"Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate. Os posts ser√£o quebrados em 2 partes: O post que voc√™‚Ä¶","html":"<p>Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate. Os posts ser√£o quebrados em 2 partes:</p>\n<ul>\n<li>O post que voc√™ est√° lendo ser√° como modelar sua aplica√ß√£o utilizando Statecharts e Xstate/Viz onde vamos cubrir alguns dos principais conceitos de Statecharts.</li>\n<li>Escrevendo sua aplica√ß√£o com React e Xstate</li>\n</ul>\n<p>Sem mais delongas, bora pro post de hoje!</p>\n<p>Antes de come√ßarmos a modelar uma aplica√ß√£o, precisamos entender um pouco mais sobre alguns dos conceitos de Statecharts, vale lembrar tamb√©m que todos os exemplos ser√£o usando Xstate mas voc√™ n√£o precisa de nenhuma lib para come√ßar usar hoje mesmo. Durante o desenvolvimento do modelo, vamos cobrir os seguintes conceitos:</p>\n<ul>\n<li>context</li>\n<li>state</li>\n<li>invoke</li>\n<li>actions</li>\n<li>guards</li>\n</ul>\n<p>Uma das features mais legais do Xstate √© poder vizualizar seu c√≥digo, hoje vamos usar o xstate/viz que vai nos ajudar a criar nosso modelo. Antes de mais nada, abra o seguinte link: xstate/viz , voc√™ provavelmente ver√° uma p√°gina igual a da imagem abaixo, ele ir√° iniciar com uma fetch machine e com o c√≥digo do exemplo do lado direito.</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-1.png\" alt=\"imagem mostrando o xstate/viz aberto com uma fetch machine.\"></p>\n<p>A primeira coisa que vamos fazer √© atualizar o c√≥digo no Xstate/Viz para o c√≥digo abaixo e clicar em update:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>O c√≥digo acima √© o c√≥digo basico para iniciarmos uma nova State Machine, cada state machine recebe um id √∫nico, um estado inicial e claro, a lista de estados dispon√≠veis. O resultado ser√°:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-2.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>A primeira coisa a se fazer √© pensar em quais estados nossa aplica√ß√£o pode ter, nesse exemplo vamos criar uma aplica√ß√£o que, ao clicar em um bot√£o busca de uma API uma imagem de um gatinho. A aplica√ß√£o tamb√©m tratar√° errors na api, habilitando o usu√°rio a tentar novamente por 3 vezes consecutivas caso a API retorne errors.</p>\n<p>Com essa breve descri√ß√£o podemos ent√£o dizer que nossa aplica√ß√£o ter√° os seguintes estados:</p>\n<ul>\n<li>idle</li>\n<li>loading</li>\n<li>success</li>\n<li>error</li>\n<li>cant_retry</li>\n</ul>\n<p>O resultado em c√≥digo ficaria assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E o resultado no xstate/viz:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-3.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>N√£o se preocupe caso voc√™ esque√ßa de algum estado da primeira vez, aos poucos e com pr√°tica voc√™ vai pegando maldade e vai conseguir ser mais assertivo em quais estados sua aplica√ß√£o ou seu componente deve ter. Alterar caso precise √© mais simples do que parece, voc√™ pode usar o xstate/viz para te ajudar a vizualizar as mudan√ßas e testar todos os fluxos poss√≠veis.</p>\n<p>Lembra do nosso diagrama de transi√ß√£o de estados falado no primeiro post dessa s√©rie, onde mostramos que come√ßando em um estado A ‚áí um vento X aconteceu ‚áí vamos para um estado B ? O pr√≥ximo passo √© definir quais eventos dentro do seu sistema for√ßa uma transi√ß√£o de estado. Exemplo, quando estamos no estado inicial (<strong>idle)</strong> podemos dizer que o evento <strong>LOAD<em>NEW</em>PICTURE</strong> for√ßa uma transi√ß√£o para o estado <strong>loading</strong> ou seja:</p>\n<ul>\n<li><strong>idle ‚áí LOAD<em>NEW</em>PICTURE ‚áí loading</strong></li>\n<li><strong>loading ‚áí ON_DONE ‚áí sucess</strong></li>\n<li><strong>loading ‚áí ON_ERROR ‚áí error</strong></li>\n<li><strong>success ‚áí LOAD<em>NEW</em>PICTURE ‚áí loading</strong></li>\n<li><strong>error ‚áí RETRY ‚áí loading</strong></li>\n</ul>\n<p>Em c√≥digo ficaria:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">ON_DONE</span><span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token constant\">ON_ERROR</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>  \n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>e no xstate/viz:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-4.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>Vizualizar seu c√≥digo √© muito interessante, no exemplo acima, podemos ver nitidamente qual evento leva a aplica√ß√£o para outro estado e todos os fluxos poss√≠veis. E inclusive furos no sistema, veja como o estado cant_retry nunca acontecer√° pois nenhum evento for√ßa uma transi√ß√£o at√© ele ü§∑‚Äç‚ôÇÔ∏è mas calma, n√≥s vamos chegar l√°.</p>\n<h3>Context</h3>\n<p>Context √© uma feature da lib Xstate que ter permite salvar contextos din√¢micos dependendo do estado que sua aplica√ß√£o est√°. Context nesse caso √© o nosso famoso estado como estamos acostumados a usar com outras libs como Redux, Mobx, Context Api no caso de usar com React, ou at√© mesmo um simples componente state.</p>\n<p>Nesse caso, nosso contexto ser√° a nossa foto atual para ser exibida e a quantidade de vezes que o usu√°rio tentou buscar uma nova foto em caso de erros, precisamos iniciar nossa machine com o contexto inicial, o c√≥digo ent√£o ficaria dessa forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">ON_DONE</span><span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token constant\">ON_ERROR</span><span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>  \n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Perceba que nesse caso, n√£o temos nenhuma altera√ß√£o nos estados da aplica√ß√£o. Mas no xstate/viz se voc√™ abrir a aba chamada <code class=\"language-text\">State</code> voc√™ pode ver que ele te mostra qual o estado atual da aplica√ß√£o e qual os valores do contexto naquele momento.</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-5.png\" alt=\"imagem mostrando a aba state no xstate/viz\"></p>\n<h3>Trabalhando com a√ß√µes ass√≠ncronas</h3>\n<p>Em qualquer aplica√ß√£o sempre teremos a√ß√µes que s√£o ass√≠ncronas e os resultados dessas a√ß√µes podem ou n√£o resultar em uma transi√ß√£o de estado. Usando Xstate chamamos isso de Services, e chamar um servi√ßo √© t√£o f√°cil e declarativo quanto qualquer outro conceito.</p>\n<p>No nosso exemplo, o servi√ßo ser√° uma promise que vai fazer o request para buscar uma nova foto. O resultado dessa promise, se com sucesso ou erro gerara transi√ß√µes de estados. Pensando em um fluxo de dados quando a aplica√ß√£o sai do estado de ocioso(idle) para loading √© nesse momento que devemos ent√£o fazer nosso request. Preste bem aten√ß√£o no estado de loading no proximo exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t        src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n          onDone<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n          onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">fetchNewPicture</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> \n   <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Substitu√≠mos nossos eventos por uma key chamada <strong>invoke,</strong> que recebe nesse exemplo, 3 configura√ß√µes: </p>\n<ul>\n<li><strong>src</strong>:  √â uma fun√ß√£o que retorna uma promisse. No nosso c√≥digo estamos passando apenas o nome da fun√ß√£o que ser√° chamada  e como segundo par√¢metro da fun√ß√£o <strong>Machine</strong>, passamos um objeto com a key <strong>services</strong> que nada mais √© que outro objeto com todos os servi√ßos que podem ser chamados.</li>\n<li><strong>onDone</strong>: Qual o pr√≥ximo estado vamos redirecionar nossa machine se tudo ocorrer bem.</li>\n<li><strong>onError</strong>: Qual o pr√≥ximo estado vamos redirecionar nossa machine se algum erro acontecer.</li>\n</ul>\n<p>Vale lembrar que um servi√ßo pode ser uma promisse, observables, callback ou outra machine.</p>\n<p>A vizualiza√ß√£o do nosso c√≥digo ficaria assim:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-6.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>Da pra perceber que o viz coloca invoke / nome do servi√ßo dentro da quadradinho que representa o estado atual e tamb√©m o nome do servi√ßo dentro de um par√™nteses nos eventos simbolizando que aquele evento est√° relacionado ao servi√ßo chamado.</p>\n<h3>Actions</h3>\n<p>Actions s√£o fun√ß√µes do tipo fire-and-forget, ou seja, fun√ß√µes  que n√£o geram uma transi√ß√£o de estados. As actions por√©m, s√£o muito usadas para rodar qualquer tipo de side effect que podem atualizar nosso contexto.</p>\n<p>No nosso exemplo, quando a promisse que busca uma nova foto retorna precisamos chamar uma action para atualizar o valor do nosso contexto currentImageUrl.</p>\n<p>Qualquer transi√ß√£o de estado dentro do Xstate pode receber apenas uma string com o nome do novo estado ou um objeto de configura√ß√£o, onde passamos o target que representa o pr√≥ximo estado e outras configura√ß√µes como por exemplo, uma action. Nesse caso vamos alterar nosso invoke objeto para:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n  onDone<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    target<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n    actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setCurrentImageUrl'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Perceba que passamos apenas uma string que √© refer√™ncia para uma fun√ß√£o action, tamb√©m vamos passar a action no segundo parametro da fun√ß√£o Machine, dessa forma, eu acredito que fica mais simples de ler nossa machine. O c√≥digo final ficaria assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t        src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n          onDone<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t    target<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t    actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setCurrentImageUrl'</span><span class=\"token punctuation\">]</span>\n\t\t\t\t  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">fetchNewPicture</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">setCurrentImageUrl</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token punctuation\">,</span> event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       currentImageUrl<span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>imageUrl\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Uma action recebe por par√¢metro, o contexto atual e um event, esse event nada mais √© do que o retorno do servi√ßo, como nosso servi√ßo nesse caso √© uma promisse, nosso event ser√° o retorno dela. Caso nosso servi√ßo fosse um callback por ex, esse event seria a chamada do callback com qualquer informa√ß√£o adicional que o servi√ßo queira passar para a action.</p>\n<p>A vizualiza√ß√£o do c√≥digo ficaria assim:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-7.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>Perceba que o Viz coloca uma lista de a√ß√µes que acontecem quando um evento √© disparado com do / nome da action bem abaixo da representa√ß√£o visual de um evento.</p>\n<p>Seguindo nosso exemplo, sempre que a promisse retornar um erro e o usu√°rio envia o evento RETRY devemos incrementar o valor de retryTimes no nosso contexto,  tamb√©m devemos resetar esse valor caso a promisse retorne com sucesso. Nesse caso, vamos adiconar uma action quando chamamos o evento RETRY e outra quando a promisse retorna com sucesso:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t        src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n          onDone<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t    target<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t    actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setCurrentImageUrl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'resetRetryTimes'</span><span class=\"token punctuation\">]</span>\n\t\t\t\t  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            target<span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n            actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'incrementRetryTimes'</span><span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">fetchNewPicture</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">setCurrentImageUrl</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token punctuation\">,</span> event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       currentImageUrl<span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>imageUrl\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">resetRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">incrementRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       retryTimes<span class=\"token operator\">:</span>  context<span class=\"token punctuation\">.</span>retryTimes <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A vizualiza√ß√£o do c√≥digo ficaria assim:</p>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-8.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>Agora voc√™ j√° sabe reconhecer quando uma action √© chamada apenas olhando a vizualiza√ß√£o do c√≥digo üöÄ.</p>\n<h3>Guards</h3>\n<p>Guards s√£o usados para garantir que uma transi√ß√£o de estado que depende de alguma regra de negocio seja feita com seguran√ßa, usando o nosso exemplo, quando a promisse que busca uma nova foto retorna um erro, o usu√°rio pode tentar buscar novamente por 3 vezes. Ao tentar 3 vezes e sem sucesso, o usu√°rio √© ent√£o redirecionado para um estado onde ele n√£o pode mais tentar buscar uma nova foto.</p>\n<p>Para fazer isso acontecer iremos usar os guards, o jeito de configurar um guard √© bem simples, no nosso caso, o evento RETRY vai conter duas poss√≠veis branchs:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          target<span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n          actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'incrementRetryTimes'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n        <span class=\"token punctuation\">{</span>\n          target<span class=\"token operator\">:</span> <span class=\"token string\">'cant_retry'</span>\n        <span class=\"token punctuation\">}</span>\n       <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nesse caso nada acontece, pois ainda n√£o adicionamos o nosso guard, para adicionar um ou mais guards basta colocar uma key cond na branch que deve ser redirecionada apenas se o guard retornar true. As branchs s√£o sempre lidas por ordem que foram declaradas, ou seja, nesse caso vamos colocar nosso guard na primeira branch, caso o retorno do guard seja falso iremos ent√£o para a pr√≥xima op√ß√£o que vai ent√£o for√ßar uma transi√ß√£o de estado para o estado cant_retry,  nosso c√≥digo ficaria assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          target<span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n          actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'incrementRetryTimes'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          cond<span class=\"token operator\">:</span> <span class=\"token string\">'canRetry'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n        <span class=\"token punctuation\">{</span>\n          target<span class=\"token operator\">:</span> <span class=\"token string\">'cant_retry'</span>\n        <span class=\"token punctuation\">}</span>\n       <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Novamente usamos a string para referenciar ao nome da fun√ß√£o guard que estar√° no segundo par√¢metro do m√©todo Machine, c√≥digo final ficaria assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span> \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t        src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n          onDone<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t    target<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t    actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setCurrentImageUrl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'resetRetryTimes'</span><span class=\"token punctuation\">]</span>\n\t\t\t\t  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t        <span class=\"token punctuation\">{</span>\n\t          target<span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n\t          actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'incrementRetryTimes'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t          cond<span class=\"token operator\">:</span> <span class=\"token string\">'canRetry'</span>\n\t        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n\t        <span class=\"token punctuation\">{</span>\n\t          target<span class=\"token operator\">:</span> <span class=\"token string\">'cant_retry'</span>\n\t        <span class=\"token punctuation\">}</span>\n\t       <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">fetchNewPicture</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">setCurrentImageUrl</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token punctuation\">,</span> event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       currentImageUrl<span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>imageUrl\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">resetRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">incrementRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       retryTimes<span class=\"token operator\">:</span>  context<span class=\"token punctuation\">.</span>retryTimes <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   guards<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">canRetry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> context<span class=\"token punctuation\">.</span>retryTimes <span class=\"token operator\">&lt;=</span> <span class=\"token number\">3</span>\n   <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><img src=\"/blog/images/modeling-your-first-application-using-statecharts-and-xstate/image-9.png\" alt=\"imagem mostrando o resultado do codigo colado no xstate/viz\"></p>\n<p>Perceba que agora nosso estado cant_retry tem uma liga√ß√£o com o evento Retry, e n√≥s temos dois eventos Retry que representam por ordem as branchs que declaramos. Perceba tamb√©m que a primeira branch dentro do evento tem um array de guards e os nomes dessas condi√ß√µes, um guard fica verde em caso retorne true e vermelho em caso retorne false representando que aquele evento n√£o vai acontecer.</p>\n<h3>Type final</h3>\n<p>Estados do tipo final, representam que aquela machine est√° terminada, ou seja, nenhum evento ou transi√ß√£o ir√° acontecer depois que a machine chegar a esse estado. No nosso exemplo, o estado cant_retry √© nosso estado final. Vale lembrar que uma machine n√£o necessariamente precisa ter um estado final.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> catsApp <span class=\"token operator\">=</span> <span class=\"token function\">Machine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">:</span> <span class=\"token string\">'catsApp'</span><span class=\"token punctuation\">,</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token string\">'idle'</span><span class=\"token punctuation\">,</span>\n\t  context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t    currentImageUrl<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n      retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    states<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        invoke<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t        src<span class=\"token operator\">:</span> <span class=\"token string\">'fetchNewPicture'</span><span class=\"token punctuation\">,</span>\n          onDone<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t    target<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t    actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setCurrentImageUrl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'resetRetryTimes'</span><span class=\"token punctuation\">]</span>\n\t\t\t\t  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          onError<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      success<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token constant\">LOAD_NEW_PICTURE</span><span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      error<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        on<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token constant\">RETRY</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n\t        <span class=\"token punctuation\">{</span>\n\t          target<span class=\"token operator\">:</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n\t          actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'incrementRetryTimes'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t          cond<span class=\"token operator\">:</span> <span class=\"token string\">'canRetry'</span>\n\t        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n\t        <span class=\"token punctuation\">{</span>\n\t          target<span class=\"token operator\">:</span> <span class=\"token string\">'cant_retry'</span>\n\t        <span class=\"token punctuation\">}</span>\n\t       <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cant_retry<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'final'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">fetchNewPicture</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">setCurrentImageUrl</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token punctuation\">,</span> event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       currentImageUrl<span class=\"token operator\">:</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>imageUrl\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">resetRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> retryTimes<span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">incrementRetryTimes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n       retryTimes<span class=\"token operator\">:</span>  context<span class=\"token punctuation\">.</span>retryTimes <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   guards<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">canRetry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> context<span class=\"token punctuation\">.</span>retryTimes <span class=\"token operator\">&lt;=</span> <span class=\"token number\">3</span>\n   <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Bom modelar uma aplica√ß√£o parece divertido agora, principalmente sabendo que todo o c√≥digo que escrevemos nessa tarefa √© o mesmo c√≥digo que ser√° usado na aplica√ß√£o final. No pr√≥ximo post iremos de fato usar esse codigo e criar nossa aplica√ß√£o front-end usando react e xstate.</p>\n<p>Te vejo l√°!</p>","fields":{"slug":"/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/"},"frontmatter":{"title":"Modelando sua primeira aplica√ß√£o com Statecharts e Xstate","date":"November 22, 2020","description":"Nesse e nos pr√≥ximos posts vamos contruir uma aplica√ß√£o utilizando Statecharts e a ajuda da lib Xstate...","languageKey":"pt_br","languageLink":"/en/modeling-your-first-application-using-statecharts-and-xstate"}}},"pageContext":{"slug":"/pt-br/modelando-sua-primeira-aplicacao-com-statecharts-e-xstate/","previous":{"fields":{"slug":"/en/modeling-your-first-application-using-statecharts-and-xstate/"},"frontmatter":{"title":"Modeling your first application using Statecharts and Xstate"}},"next":null}},"staticQueryHashes":["63159454"]}